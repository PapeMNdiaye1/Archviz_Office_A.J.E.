<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="icon" href="" />
    <meta name="description" content="Appartement - F4" />
    <meta name="Keywords"
        content="Visualisation architecturale, ArchViz, Architectur, Visualisation 3D, 3D sénégal, Architectur sénégal," />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
        ArchViz
    </title>

    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script rel=preload src="https://unpkg.com/aframe-event-set-component/dist/aframe-event-set-component.min.js">
    </script>



    <link rel="stylesheet" href="./Style/Style.css">
    <!-- ########################################################################################### -->
</head>

<body>

    <div class='hover_loader_container'>
        <div class='hover_loader'>
            <div class="lds-ellipsis">
                <div></div>
                <div></div>
                <div></div>
                <div></div>
            </div>
        </div>
    </div>

    <a class="link_to_archviz" href="https://www.prodesign.sn/" target="_blank">
    </a>


    <div class="the_blach_hover">
    </div>

    <a-scene id="the_scene" the_scene cursor="rayOrigin: mouse" loading-screen="enabled:false">

        <a-assets>
            <img id="Arrow-1" src="./Style/Images/PNG/Arrow-1.png">
            <img id="Scene-1" src="./Style/Images/Scene-1.jpg">
            <img id="Scene-0" src="./Style/Images/Scene-0.jpg">
            <img id="Scene-2" src="./Style/Images/Scene-2.jpg">
    
        </a-assets>

        <a-entity laser-controls="hand: left"
            raycaster="objects: [data-clickable] ; far: 500; lineColor: #23343b; lineOpacity: 0.5"></a-entity>
        <a-entity laser-controls="hand: right"
            raycaster="objects: [data-clickable] ; far: 500; lineColor: #23343b; lineOpacity: 0.5"></a-entity>

        <a-sky id="image-360" radius="500" rotation="0 -90 0" src="#Scene-0" look-controls-invert-y="false"
            animation__fade="property: components.material.material.color; type: color; from: #FFF; to: #000; dur: 300; startEvents: fade"
            animation__fadeback="property: components.material.material.color; type: color; from: #000; to: #FFF; dur: 300; startEvents: animationcomplete__fade">
        </a-sky>
        <!-- ############################################################ -->
        <!-- ############################################################ -->
        <!-- ############################################################ -->
        <!-- ############################################################ -->

        <!-- Group-1. -->
        <a-entity scale="0 0 0" rotation="0 -90 0" class="groups" id="Group-1" visible="false">

            <a-plane data-clickable scale='0.9 0.9 0.9' opacity='.5' class="pintings clickable"
            position="2.5967 -1.27619 0.76296" rotation="-87.1188057074368 -35.937058826195496 -53.55264623749265"
            material="src: #Arrow-1; transparent:true" the_dote="Name_of_dote: Dote-0  ; Group_to_activate: Group-0 ; The_rotation: 0">
            </a-plane>


            <a-plane data-clickable scale='0.9 0.9 0.9' opacity='.5' class="pintings clickable"
            position="-3.3275 -1.27619 1.9179" rotation="-77.73948660114523 78.9507193800518 -168.72117376335405" 
            material="src: #Arrow-1; transparent:true"
                the_dote="Name_of_dote: Dote-2  ; Group_to_activate: Group-2 ; The_rotation: 0">
            </a-plane>

        

        </a-entity>
        <!-- Group-0. -->
        <a-entity scale="1 1 1" rotation="0 -90 0" class="groups" id="Group-0" visible="true">

            <a-plane data-clickable scale='0.9 0.9 0.9' opacity='.5'
             class="pintings clickable"
             position="-3.41781 -1.69372 -0.9974" rotation="-48.41092298398865 85.76146869077188 2.573726415727658" 
             material="src: #Arrow-1; transparent:true"
             the_dote="Name_of_dote: Dote-1  ; Group_to_activate: Group-1 ; The_rotation: 0">
            </a-plane>


        </a-entity>
        <!-- Group-2. -->
        <a-entity scale="0 0 0" rotation="0 -90 0" class="groups" id="Group-2" visible="false">

            <a-plane data-clickable scale='0.9 0.9 0.9' opacity='.5' class="pintings clickable"
            position="3.08397 -1.27619 -2.11691" rotation="-60.16973581345853 -85.30711315923314 -3.597601995626439" 
                material="src: #Arrow-1; transparent:true"
                the_dote="Name_of_dote: Dote-1  ; Group_to_activate: Group-1 ; The_rotation: 0">
            </a-plane>

    
         

        </a-entity>
   
 

        <!-- ############################################################ -->
        <!-- ############################################################ -->
        <!-- ############################################################ -->
        <!-- ############################################################ -->
    </a-scene>
    <script>
        let loaderContainer = document.querySelector('.hover_loader_container')
        let groups = document.querySelectorAll('.groups')
        let the_sky = document.querySelector('#image-360')
        let the_cursor = document.querySelector('.a-mouse-cursor-hover')
        let theBlachHover = document.querySelector('.the_blach_hover')
        let img_1 = document.querySelector('#Scene-1')
        // console.log(img_1.src);


        //############################################
        AFRAME.registerComponent('the_dote', {
            schema: { Name_of_dote: { type: 'string', default: '#Name', }, Group_to_activate: { type: 'string', default: '#Position', }, The_rotation: { type: 'string', default: '0', } },

            init: function () {
                var stringToLog = this.data;
                let Dote_Name = this.data.Name_of_dote
                let Group_to_activate = this.data.Group_to_activate
                let TheRotation = this.data.The_rotation
                let The_Arrow = this.el
                this.el.setAttribute('event-set__mouseleave', "scale: 0.9 0.9 0.9 ; opacity : 0.5 ")
                this.el.setAttribute('event-set__mouseenter', "scale: 1.1 1.1 1.1 ; opacity : 1")
                this.el.addEventListener('click', (theDote) => {
                    console.log(Dote_Name);

                    //################################
                    let the_img = document.querySelector(`#Scene-${Dote_Name.substring(5)}`)

                    async function refreshImage(url) {
                        await fetch(url, { cache: 'reload', mode: 'no-cors' });
                        document
                            .querySelectorAll(`img[src='${url}']`)
                            .forEach(the_img => (the_img.src = url));
                    }

                    if (the_img.condition) {
                        console.log('Ok');
                    } else {
                        refreshImage(the_img.src)
                        console.log('not Ok');
                    }
                    //################################
                    // the_sky.setAttribute('rotation', `0 ${TheRotation} 0`)



                    theBlachHover.style.transitionDelay = '0s , 0s';
                    theBlachHover.style.opacity = '1';
                    theBlachHover.style.height = '100vh';

                    setTimeout(() => {
                        theBlachHover.style.transitionDelay = '0s , .6s';

                        switch (Dote_Name) {
                            case 'Dote-0':
                                the_sky.setAttribute('src', '#Scene-0')
                                break;
                            case 'Dote-1':
                                the_sky.setAttribute('src', '#Scene-1')
                                break;
                            case 'Dote-2':
                                the_sky.setAttribute('src', '#Scene-2')
                                break;
                      
                   
                            default:
                                break;
                        }
                        let the_group_to_activate = document.querySelector(`#${Group_to_activate}`)

                        groups.forEach(group => {
                            group.setAttribute('visible', 'false')
                            group.setAttribute('scale', '0 0 0')
                        });
                        the_group_to_activate.setAttribute('visible', 'true')
                        the_group_to_activate.setAttribute('scale', '1 1 1')

                        theBlachHover.style.opacity = '0';
                        theBlachHover.style.height = '0vh';

                    }, 1200);

                });

            }
        });

        const theInt = setInterval(intFunc, 4000)

        function intFunc() {
            if (img_1.complete) {
                loaderContainer.style.display = "none"
                console.log(img_1.complete);
                clearInterval(theInt);
            } else {
                console.log(img_1.complete);
            }
        }
    </script>

</body>

</html>